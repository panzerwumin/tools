# SSH高级用法

## 场景

仿真环境因被入侵而关闭外网，进入仿真环境需要2层跳板机，图示如下

![img](https://img.cayun.me/2018-11-29-111349.png)

## 用法

### a.直接从本机跳转到10-203

通过-J参数设置跳转代理

```
ssh -p 7711 -J sysop@10-140:7711,sysop@120-99:7711 sysop@10-203
```

### b. 从本地直接连接到10-203上的数据库，端口号为6067

\1. 将10-203的6067端口映射为本地的6067

```
ssh -NL 6067:10-203:6067 -J sysop@10-140:7711 sysop@120-99 -p7711
```

\2. 本机的mysql连接设置为127.0.0.1:6067

### c. vncviewer访问10-204上的vnc

\1. 首先在本机到120-99之间建立一条sock5通道

```
ssh -N -J sysop@10-140:7711 -D 2222 sysop@120-99 -p7711
```

\2. 配置vncviewer的代理

![img](https://img.cayun.me/2018-11-29-112855.png)

### d. 将文件从本机上传到10-203

与ssh类似，scp也支持跳转代理参数

```
scp -o "ProxyJump sysop@10-140:7711,sysop@120-99:7711" -P 7711 tmp.txt sysop@10-203:~
```

 

